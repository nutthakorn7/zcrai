interface AppVulnerability {
  application: string
  cveCount: number
  topCve: string
  highestSeverity: string
  description: string
}

interface EndpointVulnerability {
  application: string
  highestSeverity: string
  endpointCount: number
  topEndpoints: string
}

interface MdrVulnerabilitySectionProps {
  appsByVulnerabilities: AppVulnerability[]
  endpointsByVulnerabilities: EndpointVulnerability[]
  recommendation: string
}

/**
 * Vulnerability Application Section
 * Shows application and endpoint vulnerabilities
 */
export function MdrVulnerabilitySection({ 
  appsByVulnerabilities, 
  endpointsByVulnerabilities,
  recommendation 
}: MdrVulnerabilitySectionProps) {
  
  const getSeverityBadge = (severity: string) => {
    switch (severity?.toLowerCase()) {
      case 'critical':
        return 'bg-red-100 text-red-800 border-red-200'
      case 'high':
        return 'bg-orange-100 text-orange-800 border-orange-200'
      case 'medium':
        return 'bg-yellow-100 text-yellow-800 border-yellow-200'
      case 'low':
        return 'bg-green-100 text-green-800 border-green-200'
      default:
        return 'bg-gray-100 text-gray-800 border-gray-200'
    }
  }
  
  return (
    <>
      {/* Page 1: Applications */}
      <div className="mdr-page mdr-vulnerability-page">
        <div className="h-full flex flex-col">
          {/* Header */}
          <div className="bg-lime-500 text-white py-4 px-8">
            <h1 className="text-2xl font-bold">4. Vulnerability Application</h1>
          </div>
          
          {/* Content */}
          <div className="flex-1 p-6">
            <h3 className="text-lg font-semibold text-gray-800 mb-4">
              4.1 Applications by Vulnerabilities
            </h3>
            
            <table className="w-full text-sm mb-8">
              <thead>
                <tr className="bg-gray-800 text-white">
                  <th className="py-2 px-3 text-left">Application</th>
                  <th className="py-2 px-3 text-center">CVE Count</th>
                  <th className="py-2 px-3 text-left">Top CVE</th>
                  <th className="py-2 px-3 text-center">Severity</th>
                  <th className="py-2 px-3 text-left">Description</th>
                </tr>
              </thead>
              <tbody>
                {appsByVulnerabilities.map((app, index) => (
                  <tr key={index} className="border-b border-gray-200 hover:bg-gray-50">
                    <td className="py-2 px-3 font-medium">{app.application}</td>
                    <td className="py-2 px-3 text-center font-bold text-red-600">{app.cveCount}</td>
                    <td className="py-2 px-3 font-mono text-xs">{app.topCve}</td>
                    <td className="py-2 px-3 text-center">
                      <span className={`px-2 py-1 rounded text-xs font-medium border ${getSeverityBadge(app.highestSeverity)}`}>
                        {app.highestSeverity}
                      </span>
                    </td>
                    <td className="py-2 px-3 text-xs text-gray-600 max-w-[200px] truncate">
                      {app.description}
                    </td>
                  </tr>
                ))}
                {appsByVulnerabilities.length === 0 && (
                  <tr>
                    <td colSpan={5} className="py-8 text-center text-gray-400">
                      No vulnerability data available
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
            
            {/* Endpoints by Vulnerabilities */}
            <h3 className="text-lg font-semibold text-gray-800 mb-4">
              4.2 Endpoints by Vulnerabilities
            </h3>
            
            <table className="w-full text-sm">
              <thead>
                <tr className="bg-gray-800 text-white">
                  <th className="py-2 px-3 text-left">Application</th>
                  <th className="py-2 px-3 text-center">Severity</th>
                  <th className="py-2 px-3 text-center">Endpoint Count</th>
                  <th className="py-2 px-3 text-left">Top Endpoints</th>
                </tr>
              </thead>
              <tbody>
                {endpointsByVulnerabilities.map((endpoint, index) => (
                  <tr key={index} className="border-b border-gray-200 hover:bg-gray-50">
                    <td className="py-2 px-3 font-medium">{endpoint.application}</td>
                    <td className="py-2 px-3 text-center">
                      <span className={`px-2 py-1 rounded text-xs font-medium border ${getSeverityBadge(endpoint.highestSeverity)}`}>
                        {endpoint.highestSeverity}
                      </span>
                    </td>
                    <td className="py-2 px-3 text-center font-bold">{endpoint.endpointCount}</td>
                    <td className="py-2 px-3 font-mono text-xs truncate max-w-[300px]">
                      {endpoint.topEndpoints}
                    </td>
                  </tr>
                ))}
                {endpointsByVulnerabilities.length === 0 && (
                  <tr>
                    <td colSpan={4} className="py-8 text-center text-gray-400">
                      No endpoint vulnerability data available
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
          
          {/* Footer */}
          <div className="p-4 text-center text-sm text-gray-400 border-t">
            Page 9
          </div>
        </div>
      </div>
      
      {/* Page 2: Recommendation */}
      <div className="mdr-page mdr-vulnerability-recommendation-page">
        <div className="h-full flex flex-col">
          {/* Header */}
          <div className="bg-lime-500 text-white py-4 px-8">
            <h1 className="text-2xl font-bold">4.3 Vulnerability Recommendation</h1>
          </div>
          
          {/* Content */}
          <div className="flex-1 p-8">
            <div className="bg-lime-50 border-l-4 border-lime-500 p-6 rounded-r-lg">
              <h3 className="text-lg font-semibold text-lime-800 mb-4">
                ðŸ”§ Remediation Recommendations
              </h3>
              <div className="text-gray-700 whitespace-pre-wrap leading-relaxed">
                {recommendation || 'No vulnerability recommendations available.'}
              </div>
            </div>
            
            <div className="mt-8 grid grid-cols-2 gap-6">
              <div className="bg-blue-50 rounded-lg p-6 border border-blue-200">
                <h4 className="font-semibold text-blue-800 mb-3">ðŸ“‹ Short-term Actions</h4>
                <ul className="text-sm text-blue-700 space-y-2">
                  <li>â€¢ Review and prioritize critical CVEs</li>
                  <li>â€¢ Apply emergency patches where available</li>
                  <li>â€¢ Implement temporary mitigations</li>
                  <li>â€¢ Monitor affected systems closely</li>
                </ul>
              </div>
              
              <div className="bg-purple-50 rounded-lg p-6 border border-purple-200">
                <h4 className="font-semibold text-purple-800 mb-3">ðŸŽ¯ Long-term Strategy</h4>
                <ul className="text-sm text-purple-700 space-y-2">
                  <li>â€¢ Establish regular patching schedule</li>
                  <li>â€¢ Implement vulnerability scanning automation</li>
                  <li>â€¢ Set up software lifecycle management</li>
                  <li>â€¢ Train staff on security best practices</li>
                </ul>
              </div>
            </div>
          </div>
          
          {/* Footer */}
          <div className="p-4 text-center text-sm text-gray-400 border-t">
            Page 10
          </div>
        </div>
      </div>
    </>
  )
}
